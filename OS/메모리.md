# 메모리

- CPU는 메모리에 올라와 있는 프로그램의 명령어들을 실행한다.

## 메모리 계층

- 메모리 계층은 위에서 부터 레지스터, 캐시, 메모리, 저장장치 순서로 구성되어 있다.
  - 레지스터
    - CPU안에 있는 작은 메모리, 휘발성, 속도가 빠르다, 기억 용량이 가장 적다.
  - 캐시
    - L1, L2 캐시를 지칭한다. 휘발성, 속도 빠르다. 기억 용량이 적다.
  - 주기억 장치
    - RAM을 가리킨다. 휘발성, 속도 보통, 기억 용량이 보통이다.
  - 보조기억장치
    - HDD, SDD를 말한다. 휘발성, 속도 낮음, 기억 용량이 많다.
- 램은 하드디스크로부터 일정량의 데이터를 복사해서 임시 저장하고 이를 필요 시마다 CPU에 빠르게 전달하는 역할을 한다.
- 계층 위로 올라갈수록 가격을 비싸지는데 용량은 작아지고 속도는 빨라진다.
- 계층이 있는 이유는 경제성과 캐시 때문이다.

### 캐시

- 데이터를 미리 복사해 놓는 임시 저장소이다.
- 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리다.
- 데이터를 접근하는 시간이 오래 걸리는 경우를 해결하고 무언가를 다시 계산하는 시간을 절약할 수 있다.
- 메모리와 CPU 사이의 속도 차이가 너무 크기 때문에 그 중간에 레지스터 계층을 둬서 속도 차이를 해결한다.
- 속도 차이를 해결하기 위해 계층과 계층 사이에 있는 계층을 캐싱 계층이라고 한다.

#### 지역성의 원리

1. 시간 지역성

- 최근 사용한 데이터에 다시 접근하려는 특성을 말한다.

2. 공간 지역성

- 최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성을 말한다.

### 캐시히트와 캐시미스

- 캐시에서 원하는 데이터를 찾았다면 캐시히트라고 한다.
- 해당 데이터가 캐시에 없다면 주 메모리로 가서 데이터를 찾아오는 것을 캐시미스라고 한다.
- 캐시히트의 경우 위치도 가깝고 CPU 내부 버스를 기반으로 작동하기 때문에 빠르다.
- 캐시미스가 발생되면 시스템 버스를 기반으로 메모리에서 가져오기 때문에 느리다.

#### 캐시 매핑

- 캐시가 히트뒤기 위해 매핑하는 방법이다.
- CPU의 레지스터와 주 메모리간에 데이터를 주고받을 때를 기반으로 한다.

1. 직접 매핑

- 메모리가 1~100이 있고 캐시가 1~10이 있다면 1:1~10, 2:1~20... 이런 식으로 매핑하는 것이다.
- 처리가 빠르지만 충돌 발생이 잦다.

2. 연관 매핑

- 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑한다.
- 충돌이 적지만 모든 블록을 탐색해야 해서 속도가 느리다.

3. 집합 연관 매핑

- 직접 매핑과 연관 매핑을 합쳐 놓은 것이다.
- 순서는 일치시키지만 집합을 둬서 저장하며 블록화되어 있기 때문에 검색은 좀 더 효율적이다.

#### 웹 브라우저의 캐시

- 사용자의 커스텀한 정보나 인증 모듈 관련 사항들을 웹 브라우저에 저장해서 추후 서버에 요청할 때 자신을 나타내는 아이덴티티나 중복 요청 방지를 위해 쓰인다.

1. 쿠키

- 만료기한이 있는 키-값 저장소이다.
- same site 옵션을 strict로 설정하지 않았을 경우 다른 도메인에서 요청했을 때 자동 전송된다.
- 쿠키를 설정할 때는 document.cookie로 쿠키를 볼 수 없게 httponly 옵션을 거는 것이 중요하다.
- 클라이언트 또는 서버에서 만료기한 등을 정할 수 있는데 보통 서버에서 만료기한을 정한다.

2. 로컬 스토리지

- 만료기한이 없는 키-값 저장소이다.
- 웹 브라우저를 닫아도 유지되고 도메인 단위로 저장, 생성된다.
- 클라이언트에서만 수정 가능하다.

3. 세션 스토리지

- 만료기한이 없는 키-값 저장소이다.
- 탭 단위로 세션 스토리지를 생성하며 탭을 닫을 때 해당 데이터가 삭제된다.
- 클라이언트에서만 수정 가능하다.

#### 테이터베이스의 캐싱 계층

- 데이터베이스 시스템을 구축할 때도 메인 데이터베이스 위에 레디스 데이터 베이스 계층을 캐싱 계층으로 둬서 성능을 향상시킨다.
